CREATE SCHEMA "public";
CREATE TYPE "Tipo_Factura" AS ENUM('A', 'B');
CREATE TYPE "Tipo_Documento" AS ENUM('DNI', 'PASAPORTE', 'LE', 'LC', 'OTRO');
CREATE TYPE "Estado_Factura" AS ENUM('PENDIENTE', 'PAGADA');
CREATE TYPE "Moneda" AS ENUM('PESOS ARGENTINOS', 'PESOS URUGUAYOS', 'DOLARES', 'EUROS', 'REALES');
CREATE TYPE "Tipo_Cama" AS ENUM('INDIVIDUAL', 'DOBLE', 'KING');
CREATE TYPE "Tipo_Servicio" AS ENUM('LAVANDERIA', 'SAUNA', 'BAR');
CREATE TYPE "Estado_Reserva" AS ENUM('ACTIVA', 'CANCELADA', 'TERMINADA');
CREATE TYPE "Tipo_habitacion" AS ENUM('INDIVIDUAL ESTANDAR', 'DOBLE ESTANDAR', 'DOBLE SUPERIOR', 'SUPERIOR FAMILY PLAN', 'SUITE DOBLE');
CREATE TYPE "Pos_IVA" AS ENUM('CONSUMIDOR FINAL', 'MONOTRIBUTISTA', 'RESPONSABLE INSCRIPTO', 'EXENTO');
CREATE TYPE "Estado_Habitacion" AS ENUM('HABILITADA', 'FUERA DE SERVICIO');
CREATE TYPE "RedDePago" AS ENUM('VISA', 'MASTERCARD');
CREATE TYPE "EsResponsable" AS ENUM('SI', 'NO');
CREATE TABLE "cama" (
	"id_cama" serial PRIMARY KEY,
	"tipo_cama" Tipo_Cama,
	"id_habitacion" text NOT NULL
);
CREATE TABLE "cheque" (
	"numero_cheque" varchar(50) PRIMARY KEY,
	"banco" varchar(100),
	"fecha_cobro" date,
	"plaza" text,
	"fecha_de_pago" date,
	"moneda" varchar(255),
	"monto" double precision,
	CONSTRAINT "cheque_moneda_check" CHECK (CHECK (((moneda)::text = ANY ((ARRAY['PESOS_ARGENTINOS'::character varying, 'DOLARES'::character varying, 'REALES'::character varying, 'PESOS_URUGUAYOS'::character varying, 'EUROS'::character varying])::text[]))))
);
CREATE TABLE "direccion" (
	"id_direccion" serial PRIMARY KEY,
	"calle" varchar(150),
	"provincia" varchar(100),
	"localidad" varchar(100),
	"pais" varchar(100),
	"numero" integer,
	"departamento" text,
	"piso" text,
	"codPostal" integer
);
CREATE TABLE "efectivo" (
	"id_efectivo" serial PRIMARY KEY,
	"fecha_de_pago" date,
	"moneda" varchar(255),
	"monto" real,
	CONSTRAINT "efectivo_moneda_check" CHECK (CHECK (((moneda)::text = ANY ((ARRAY['PESOS_ARGENTINOS'::character varying, 'DOLARES'::character varying, 'REALES'::character varying, 'PESOS_URUGUAYOS'::character varying, 'EUROS'::character varying])::text[]))))
);
CREATE TABLE "email_huesped" (
	"email" text,
	"nro_documento" varchar(20),
	"tipo_documento" Tipo_Documento,
	CONSTRAINT "email_huesped_pkey" PRIMARY KEY("email","tipo_documento","nro_documento")
);
CREATE TABLE "estadia" (
	"id_estadia" serial PRIMARY KEY,
	"fecha_check-in" date NOT NULL,
	"fecha_check-out" date,
	"valor_estadia" double precision,
	"id_reserva" serial,
	"numero_habitacion" text NOT NULL
);
CREATE TABLE "estadia_huesped" (
	"id_estadia" integer,
	"tipo_documento" Tipo_Documento,
	"nro_documento" varchar(20),
	"responsable" EsResponsable DEFAULT 'NO',
	CONSTRAINT "estadia_huesped_pkey" PRIMARY KEY("id_estadia","tipo_documento","nro_documento")
);
CREATE TABLE "factura" (
	"numero_factura" varchar(20) PRIMARY KEY CONSTRAINT "factura_numero_factura_key" UNIQUE,
	"fecha_emision" date NOT NULL,
	"importe_total" double precision NOT NULL,
	"id_estadia" integer NOT NULL,
	"id_nota_credito" integer,
	"id_responsable" integer NOT NULL,
	"importe_neto" double precision,
	"fecha_vencimiento" date,
	"IVA" double precision,
	"estado" Estado_Factura,
	"tipo_factura" Tipo_Factura
);
CREATE TABLE "habitacion" (
	"numero" text PRIMARY KEY DEFAULT nextval('habitacion_id_habitacion_seq'::regclass),
	"capacidad" integer NOT NULL,
	"costo_por_noche" real,
	"tipo_habitacion" Tipo_habitacion NOT NULL,
	"estado_habitacion" Estado_Habitacion
);
CREATE TABLE "huesped" (
	"cuit" varchar(13) DEFAULT nextval('huesped_id_huesped_seq'::regclass),
	"nombres" varchar(100) NOT NULL,
	"apellido" varchar(100) NOT NULL,
	"nacionalidad" varchar(50),
	"id_direccion" integer NOT NULL,
	"tipo_documento" Tipo_Documento,
	"numero_documento" varchar(20),
	"fecha_nacimiento" date,
	"pos_iva" Pos_IVA DEFAULT 'CONSUMIDOR FINAL',
	CONSTRAINT "huesped_pkey" PRIMARY KEY("numero_documento","tipo_documento")
);
CREATE TABLE "medio_pago" (
	"id_pago" integer NOT NULL,
	"id_efectivo" integer,
	"numero_cheque" varchar(50),
	"numero_tarjeta" varchar(20),
	"id_medio_pago" serial PRIMARY KEY,
	"moneda" Moneda,
	"fecha_pago" date,
	"monto" double precision
);
CREATE TABLE "nota_de_credito" (
	"numero_nota_credito" serial,
	"monto_devolucion" double precision NOT NULL,
	CONSTRAINT "nota_credito_pkey" PRIMARY KEY("numero_nota_credito")
);
CREATE TABLE "ocupacion_huesped" (
	"ocupacion" text,
	"tipo_documento" Tipo_Documento,
	"nro_documento" varchar(20),
	CONSTRAINT "ocupacion_huesped_pkey" PRIMARY KEY("ocupacion","tipo_documento","nro_documento")
);
CREATE TABLE "pago" (
	"id_pago" serial PRIMARY KEY,
	"monto_total" double precision NOT NULL,
	"fecha_pago" date NOT NULL,
	"cotizacion" double precision,
	"id_factura" varchar(20) NOT NULL,
	"moneda" Moneda
);
CREATE TABLE "persona_fisica" (
	"id_responsable" integer PRIMARY KEY,
	"nro_documento" varchar(20) UNIQUE,
	"tipo_documento" Tipo_Documento UNIQUE,
	CONSTRAINT "uk_fvpll6g11thalf0utvn2aade" UNIQUE("nro_documento","tipo_documento")
);
CREATE TABLE "persona_juridica" (
	"id_responsable" integer PRIMARY KEY,
	"razon_social" varchar(200) NOT NULL,
	"cuit" varchar(20),
	"id_direccion" serial
);
CREATE TABLE "reserva" (
	"id_reserva" serial PRIMARY KEY,
	"fecha_hasta" date NOT NULL,
	"fecha_desde" date NOT NULL,
	"id_habitacion" text NOT NULL,
	"NombreHuespedResponsable" varchar(255),
	"ApellidoHuespedResponsable" varchar(255),
	"TelefonoHuespedResponsable" text,
	"fecha_reserva" date,
	"estado_reserva" Estado_Reserva NOT NULL,
	"NroDocumentoResponsable" varchar(255),
	"TipoDocumentoResponsable" varchar(255),
	CONSTRAINT "chk_fechas_reserva" CHECK (CHECK ((fecha_desde < fecha_hasta))),
	CONSTRAINT "reserva_TipoDocumentoResponsable_check" CHECK (CHECK ((("TipoDocumentoResponsable")::text = ANY (ARRAY[('DNI'::character varying)::text, ('LE'::character varying)::text, ('LC'::character varying)::text, ('PASAPORTE'::character varying)::text, ('OTRO'::character varying)::text]))))
);
CREATE TABLE "responsable_pago" (
	"id_responsable" serial PRIMARY KEY,
	"tipo_responsable" varchar(255) NOT NULL,
	"id_direccion" integer,
	CONSTRAINT "responsable_pago_tipo_responsable_check" CHECK (CHECK (((tipo_responsable)::bpchar = ANY (ARRAY['F'::bpchar, 'J'::bpchar]))))
);
CREATE TABLE "servicios_adicionales" (
	"id_servicio_adicional" serial PRIMARY KEY,
	"descripcion_servicio" text,
	"valor_servicio" double precision NOT NULL,
	"id_estadia" serial,
	"fecha_consumo" date,
	"tipo_servicio" Tipo_Servicio
);
CREATE TABLE "tarjeta" (
	"numero_tarjeta" varchar(20) PRIMARY KEY,
	"banco" varchar(100),
	"tipo_tarjeta" char(1) NOT NULL,
	"Red_de_pago" RedDePago NOT NULL,
	"codigo_seg" integer,
	"fecha_vencimiento" date,
	"fecha_pago" date,
	"moneda" varchar(255),
	"monto" double precision,
	CONSTRAINT "tarjeta_moneda_check" CHECK (CHECK (((moneda)::text = ANY ((ARRAY['PESOS_ARGENTINOS'::character varying, 'DOLARES'::character varying, 'REALES'::character varying, 'PESOS_URUGUAYOS'::character varying, 'EUROS'::character varying])::text[])))),
	CONSTRAINT "tarjeta_tipo_tarjeta_check" CHECK (CHECK ((tipo_tarjeta = ANY (ARRAY['C'::bpchar, 'D'::bpchar]))))
);
CREATE TABLE "tarjeta_credito" (
	"numero_tarjeta" varchar(20) PRIMARY KEY,
	"cuotas" integer
);
CREATE TABLE "tarjeta_debito" (
	"numero_tarjeta" varchar(20) PRIMARY KEY
);
CREATE TABLE "telefono_huesped" (
	"telefono" bigint,
	"tipo_documento" Tipo_Documento,
	"nro_documento" varchar(20),
	CONSTRAINT "telefono_huesped_pkey" PRIMARY KEY("telefono","tipo_documento","nro_documento")
);
CREATE TABLE "telefonos_personaJuridica" (
	"id_responsable" integer,
	"telefonos" bigint,
	CONSTRAINT "telefonos_personajuridica_pkey" PRIMARY KEY("id_responsable","telefonos")
);
CREATE TABLE "usuario" (
	"idUsuario" serial PRIMARY KEY,
	"nombre" varchar(100) NOT NULL,
	"hashContrasenia" varchar(255) NOT NULL,
	"id_usuario" integer DEFAULT nextval('usuario_id_usuario_seq1'::regclass) NOT NULL,
	"contrasenia" varchar(255),
	"tipo_usuario" varchar(255),
	"usuario" varchar(255) CONSTRAINT "uk_i02kr8ui5pqddyd7pkm3v4jbt" UNIQUE
);
ALTER TABLE "cama" ADD CONSTRAINT "cama_habitacion_fkey" FOREIGN KEY ("id_habitacion") REFERENCES "habitacion"("numero");
ALTER TABLE "email_huesped" ADD CONSTRAINT "email_huesped_huesped_fkey" FOREIGN KEY ("nro_documento","tipo_documento") REFERENCES "huesped"("numero_documento","tipo_documento");
ALTER TABLE "estadia" ADD CONSTRAINT "FK_habitacion" FOREIGN KEY ("numero_habitacion") REFERENCES "habitacion"("numero");
ALTER TABLE "estadia" ADD CONSTRAINT "FK_reserva" FOREIGN KEY ("id_reserva") REFERENCES "reserva"("id_reserva");
ALTER TABLE "estadia_huesped" ADD CONSTRAINT "estadia_huesped_huesped_fkey" FOREIGN KEY ("tipo_documento","nro_documento") REFERENCES "huesped"("tipo_documento","numero_documento");
ALTER TABLE "estadia_huesped" ADD CONSTRAINT "estadia_huesped_id_estadia_fkey" FOREIGN KEY ("id_estadia") REFERENCES "estadia"("id_estadia") ON DELETE CASCADE;
ALTER TABLE "factura" ADD CONSTRAINT "factura_id_estadia_fkey" FOREIGN KEY ("id_estadia") REFERENCES "estadia"("id_estadia");
ALTER TABLE "factura" ADD CONSTRAINT "factura_id_nota_credito_fkey" FOREIGN KEY ("id_nota_credito") REFERENCES "nota_de_credito"("numero_nota_credito");
ALTER TABLE "factura" ADD CONSTRAINT "factura_id_responsable_fkey" FOREIGN KEY ("id_responsable") REFERENCES "responsable_pago"("id_responsable");
ALTER TABLE "factura" ADD CONSTRAINT "fk_factura_estadia" FOREIGN KEY ("id_estadia") REFERENCES "estadia"("id_estadia");
ALTER TABLE "factura" ADD CONSTRAINT "fk_factura_nota_credito" FOREIGN KEY ("id_nota_credito") REFERENCES "nota_de_credito"("numero_nota_credito");
ALTER TABLE "factura" ADD CONSTRAINT "fk_factura_responsable" FOREIGN KEY ("id_responsable") REFERENCES "responsable_pago"("id_responsable");
ALTER TABLE "huesped" ADD CONSTRAINT "fk_huesped_direccion" FOREIGN KEY ("id_direccion") REFERENCES "direccion"("id_direccion");
ALTER TABLE "huesped" ADD CONSTRAINT "huesped_id_direccion_fkey" FOREIGN KEY ("id_direccion") REFERENCES "direccion"("id_direccion");
ALTER TABLE "medio_pago" ADD CONSTRAINT "pago_metodo_id_efectivo_fkey" FOREIGN KEY ("id_efectivo") REFERENCES "efectivo"("id_efectivo");
ALTER TABLE "medio_pago" ADD CONSTRAINT "pago_metodo_id_pago_fkey" FOREIGN KEY ("id_pago") REFERENCES "pago"("id_pago") ON DELETE CASCADE;
ALTER TABLE "medio_pago" ADD CONSTRAINT "pago_metodo_numero_cheque_fkey" FOREIGN KEY ("numero_cheque") REFERENCES "cheque"("numero_cheque");
ALTER TABLE "medio_pago" ADD CONSTRAINT "pago_metodo_numero_tarjeta_fkey" FOREIGN KEY ("numero_tarjeta") REFERENCES "tarjeta"("numero_tarjeta");
ALTER TABLE "ocupacion_huesped" ADD CONSTRAINT "ocupacion_huesped_huesped_fkey" FOREIGN KEY ("tipo_documento","nro_documento") REFERENCES "huesped"("tipo_documento","numero_documento");
ALTER TABLE "pago" ADD CONSTRAINT "constraint_1" FOREIGN KEY ("id_factura") REFERENCES "factura"("numero_factura");
ALTER TABLE "persona_fisica" ADD CONSTRAINT "fkoftxho9uywb62yb4p5yuqff00" FOREIGN KEY ("nro_documento","tipo_documento") REFERENCES "huesped"("numero_documento","tipo_documento");
ALTER TABLE "persona_fisica" ADD CONSTRAINT "persona_fisica_id_responsable_fkey" FOREIGN KEY ("id_responsable") REFERENCES "responsable_pago"("id_responsable") ON DELETE CASCADE;
ALTER TABLE "persona_juridica" ADD CONSTRAINT "FK_direccion" FOREIGN KEY ("id_direccion") REFERENCES "direccion"("id_direccion");
ALTER TABLE "persona_juridica" ADD CONSTRAINT "persona_juridica_id_responsable_fkey" FOREIGN KEY ("id_responsable") REFERENCES "responsable_pago"("id_responsable") ON DELETE CASCADE;
ALTER TABLE "reserva" ADD CONSTRAINT "reserva_habitacion_fkey" FOREIGN KEY ("id_habitacion") REFERENCES "habitacion"("numero");
ALTER TABLE "responsable_pago" ADD CONSTRAINT "responsable_pago_id_direccion_fkey" FOREIGN KEY ("id_direccion") REFERENCES "direccion"("id_direccion");
ALTER TABLE "servicios_adicionales" ADD CONSTRAINT "FK_estadia" FOREIGN KEY ("id_estadia") REFERENCES "estadia"("id_estadia");
ALTER TABLE "tarjeta_credito" ADD CONSTRAINT "tarjeta_credito_numero_tarjeta_fkey" FOREIGN KEY ("numero_tarjeta") REFERENCES "tarjeta"("numero_tarjeta") ON DELETE CASCADE;
ALTER TABLE "tarjeta_debito" ADD CONSTRAINT "tarjeta_debito_numero_tarjeta_fkey" FOREIGN KEY ("numero_tarjeta") REFERENCES "tarjeta"("numero_tarjeta") ON DELETE CASCADE;
ALTER TABLE "telefono_huesped" ADD CONSTRAINT "telefono_huesped_huesped_fkey" FOREIGN KEY ("tipo_documento","nro_documento") REFERENCES "huesped"("tipo_documento","numero_documento");
ALTER TABLE "telefonos_personaJuridica" ADD CONSTRAINT "telefonos_personaJuridica_fkey" FOREIGN KEY ("id_responsable") REFERENCES "persona_juridica"("id_responsable");
CREATE UNIQUE INDEX "cama_pkey" ON "cama" ("id_cama");
CREATE INDEX "idx_cama_habitacion" ON "cama" ("id_habitacion");
CREATE UNIQUE INDEX "cheque_pkey" ON "cheque" ("numero_cheque");
CREATE UNIQUE INDEX "direccion_pkey" ON "direccion" ("id_direccion");
CREATE UNIQUE INDEX "efectivo_pkey" ON "efectivo" ("id_efectivo");
CREATE UNIQUE INDEX "email_huesped_pkey" ON "email_huesped" ("email","tipo_documento","nro_documento");
CREATE UNIQUE INDEX "estadia_pkey" ON "estadia" ("id_estadia");
CREATE UNIQUE INDEX "estadia_huesped_pkey" ON "estadia_huesped" ("id_estadia","tipo_documento","nro_documento");
CREATE UNIQUE INDEX "factura_numero_factura_key" ON "factura" ("numero_factura");
CREATE UNIQUE INDEX "factura_pkey" ON "factura" ("numero_factura");
CREATE INDEX "idx_factura_estadia" ON "factura" ("id_estadia");
CREATE INDEX "idx_factura_responsable" ON "factura" ("id_responsable");
CREATE UNIQUE INDEX "habitacion_pkey" ON "habitacion" ("numero");
CREATE UNIQUE INDEX "huesped_pkey" ON "huesped" ("numero_documento","tipo_documento");
CREATE INDEX "idx_huesped_direccion" ON "huesped" ("id_direccion");
CREATE UNIQUE INDEX "medio_pago_pkey" ON "medio_pago" ("id_medio_pago");
CREATE UNIQUE INDEX "nota_credito_pkey" ON "nota_de_credito" ("numero_nota_credito");
CREATE UNIQUE INDEX "ocupacion_huesped_pkey" ON "ocupacion_huesped" ("ocupacion","tipo_documento","nro_documento");
CREATE UNIQUE INDEX "pago_pkey" ON "pago" ("id_pago");
CREATE INDEX "idx_persona_fisica_dni" ON "persona_fisica" ("nro_documento");
CREATE UNIQUE INDEX "persona_fisica_pkey" ON "persona_fisica" ("id_responsable");
CREATE UNIQUE INDEX "uk_fvpll6g11thalf0utvn2aade" ON "persona_fisica" ("nro_documento","tipo_documento");
CREATE INDEX "idx_persona_juridica_cuit" ON "persona_juridica" ("cuit");
CREATE UNIQUE INDEX "persona_juridica_pkey" ON "persona_juridica" ("id_responsable");
CREATE INDEX "idx_reserva_fechas" ON "reserva" ("fecha_hasta","fecha_desde");
CREATE INDEX "idx_reserva_habitacion" ON "reserva" ("id_habitacion");
CREATE UNIQUE INDEX "reserva_pkey" ON "reserva" ("id_reserva");
CREATE UNIQUE INDEX "responsable_pago_pkey" ON "responsable_pago" ("id_responsable");
CREATE UNIQUE INDEX "servicios_adicionales_pkey" ON "servicios_adicionales" ("id_servicio_adicional");
CREATE UNIQUE INDEX "tarjeta_pkey" ON "tarjeta" ("numero_tarjeta");
CREATE UNIQUE INDEX "tarjeta_credito_pkey" ON "tarjeta_credito" ("numero_tarjeta");
CREATE UNIQUE INDEX "tarjeta_debito_pkey" ON "tarjeta_debito" ("numero_tarjeta");
CREATE UNIQUE INDEX "telefono_huesped_pkey" ON "telefono_huesped" ("telefono","tipo_documento","nro_documento");
CREATE UNIQUE INDEX "telefonos_personajuridica_pkey" ON "telefonos_personaJuridica" ("id_responsable","telefonos");
CREATE UNIQUE INDEX "uk_i02kr8ui5pqddyd7pkm3v4jbt" ON "usuario" ("usuario");
CREATE UNIQUE INDEX "usuario_pkey" ON "usuario" ("idUsuario");